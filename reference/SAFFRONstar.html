<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>SAFFRONstar: Adaptive online mFDR control for asynchronous testing — SAFFRONstar • onlineFDR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="SAFFRONstar: Adaptive online mFDR control for asynchronous testing — SAFFRONstar"><meta property="og:description" content="Implements the SAFFRON algorithm for asynchronous online testing, as
presented by Zrnic et al. (2021)."><meta property="og:image" content="https://dsrobertson.github.io/onlineFDR/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">onlineFDR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/onlineFDR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/advanced-usage.html">Advanced usage of onlineFDR</a>
    </li>
    <li>
      <a href="../articles/theory.html">The theory behind onlineFDR</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>SAFFRONstar: Adaptive online mFDR control for asynchronous testing</h1>
    
    <div class="hidden name"><code>SAFFRONstar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Implements the SAFFRON algorithm for asynchronous online testing, as
presented by Zrnic et al. (2021).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">SAFFRONstar</span><span class="op">(</span></span>
<span>  <span class="va">d</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  <span class="va">version</span>,</span>
<span>  <span class="va">gammai</span>,</span>
<span>  <span class="va">w0</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  <span class="va">batch.sizes</span>,</span>
<span>  display_progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>d</dt>
<dd><p>Either a vector of p-values, or a dataframe with three columns: an
identifier (`id'), p-value (`pval'), and either decision.times', or `lags',
depending on which version you're using. See version for more details.</p></dd>


<dt>alpha</dt>
<dd><p>Overall significance level of the procedure, the default is
0.05.</p></dd>


<dt>version</dt>
<dd><p>Takes values 'async', 'dep' or 'batch'. This specifies the
  version of SAFFRONstar to use. <code>version='async'</code> requires a 
column of decision times (`decision.times'). <code>version='dep'</code> requires a
column of lags (`lags').
<code>version='batch'</code> requires a vector of batch sizes (`batch.sizes').</p></dd>


<dt>gammai</dt>
<dd><p>Optional vector of \(\gamma_i\). A default is provided with
\(\gamma_j\) proportional to \(1/j^(1.6)\).</p></dd>


<dt>w0</dt>
<dd><p>Initial `wealth' of the procedure, defaults to \(\alpha/10\).</p></dd>


<dt>lambda</dt>
<dd><p>Optional threshold for a `candidate' hypothesis, must be
between 0 and 1. Defaults to 0.5.</p></dd>


<dt>batch.sizes</dt>
<dd><p>A vector of batch sizes, this is required for
<code>version='batch'</code>.</p></dd>


<dt>display_progress</dt>
<dd><p>Logical. If <code>TRUE</code> prints out a progress bar for the algorithm runtime.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <dl><dt>out</dt>
<dd><p>A dataframe with the original p-values <code>pval</code>, the
  adjusted testing levels \(\alpha_i\) and the indicator function of
  discoveries <code>R</code>. Hypothesis \(i\) is rejected if the \(i\)-th
  p-value is less than or equal to \(\alpha_i\), in which case <code>R[i] =
  1</code>  (otherwise <code>R[i] = 0</code>).</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The function takes as its input either a vector of p-values, or a dataframe
with three columns: an identifier (`id'),
p-value (`pval'), or a column describing the conflict sets for the hypotheses. 
This takes the form of a vector of decision times or lags. Batch sizes can be 
specified as a separate argument (see below).</p>
<p>Zrnic et al. (2021) present explicit three versions of SAFFRONstar:</p>
<p>1) <code>version='async'</code> is for an asynchronous testing process, consisting
of tests that start and finish at (potentially) random times. The discretised
finish times of the test correspond to the decision times. These decision
times are given as the input <code>decision.times</code> for this version of the
SAFFRONstar algorithm. For this version of SAFFRONstar, Tian and Ramdas
(2019) presented an algorithm that can improve the power of the procedure in
the presence of conservative nulls by adaptively `discarding' these p-values.
This can be called by setting the option <code>discard=TRUE</code>.</p>
<p>2) <code>version='dep'</code> is for online testing under local dependence of the
p-values. More precisely, for any \(t&gt;0\) we allow the p-value \(p_t\) to
have arbitrary dependence on the previous \(L_t\) p-values. The fixed
sequence \(L_t\) is referred to as `lags', and is given as the input
<code>lags</code> for this version of the SAFFRONstar algorithm.</p>
<p>3) <code>version='batch'</code> is for controlling the mFDR in mini-batch testing,
where a mini-batch represents a grouping of tests run asynchronously which
result in dependent p-values. Once a mini-batch of tests is fully completed,
a new one can start, testing hypotheses independent of the previous batch.
The batch sizes are given as the input <code>batch.sizes</code> for this version of
the SAFFRONstar algorithm.</p>
<p>Given an overall significance level \(\alpha\), SAFFRONstar depends on
constants \(w_0\) and \(\lambda\), where \(w_0\) satisfies \(0 \le
w_0 \le \alpha\) and represents the intial `wealth' of the
procedure, and \(0 &lt; \lambda &lt; 1\) represents the threshold for a
`candidate' hypothesis. A `candidate' refers to p-values smaller than
\(\lambda\), since SAFFRONstar will never reject a p-value larger than
\(\lambda\). The algorithms also require a sequence of non-negative
non-increasing numbers \(\gamma_i\) that sum to 1.</p>
<p>Note that these SAFFRONstar algorithms control the <em>modified</em> FDR
(mFDR). The `async' version also controls the usual FDR if the p-values are
assumed to be independent.</p>
<p>Further details of the SAFFRONstar algorithms can be found in Zrnic et al.
(2021).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Zrnic, T., Ramdas, A. and Jordan, M.I. (2021). Asynchronous Online Testing of
Multiple Hypotheses. <em>Journal of Machine Learning Research</em>, 22:1-33.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="SAFFRON.html">SAFFRON</a></code> presents versions of SAFFRON for <em>synchronous</em>
p-values, i.e. where each test can only start when the previous test has
finished.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">sample.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A15432'</span>, <span class="st">'B90969'</span>, <span class="st">'C18705'</span>, <span class="st">'B49731'</span>, <span class="st">'E99902'</span>,</span></span>
<span class="r-in"><span>    <span class="st">'C38292'</span>, <span class="st">'A30619'</span>, <span class="st">'D46627'</span>, <span class="st">'E29198'</span>, <span class="st">'A41418'</span>,</span></span>
<span class="r-in"><span>    <span class="st">'D51456'</span>, <span class="st">'C88669'</span>, <span class="st">'E03673'</span>, <span class="st">'A63155'</span>, <span class="st">'B66033'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>pval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.90e-08</span>, <span class="fl">0.06743</span>, <span class="fl">0.01514</span>, <span class="fl">0.08174</span>, <span class="fl">0.00171</span>,</span></span>
<span class="r-in"><span>        <span class="fl">3.60e-05</span>, <span class="fl">0.79149</span>, <span class="fl">0.27201</span>, <span class="fl">0.28295</span>, <span class="fl">7.59e-08</span>,</span></span>
<span class="r-in"><span>        <span class="fl">0.69274</span>, <span class="fl">0.30443</span>, <span class="fl">0.00136</span>, <span class="fl">0.72342</span>, <span class="fl">0.54757</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>decision.times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">SAFFRONstar</span><span class="op">(</span><span class="va">sample.df</span>, version<span class="op">=</span><span class="st">'async'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          pval      alphai R</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  2.9000e-08 0.005468627 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  6.7430e-02 0.001803974 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  1.5140e-02 0.007272601 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  8.1740e-02 0.003607948 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  1.7100e-03 0.003607948 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  3.6000e-05 0.003607948 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  7.9149e-01 0.014545202 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  2.7201e-01 0.018153151 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  2.8295e-01 0.007379710 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 7.5900e-08 0.007379710 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 6.9274e-01 0.007379710 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 3.0443e-01 0.018316965 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 1.3600e-03 0.007874188 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 7.2342e-01 0.007874188 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 5.4757e-01 0.018811442 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sample.df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A15432'</span>, <span class="st">'B90969'</span>, <span class="st">'C18705'</span>, <span class="st">'B49731'</span>, <span class="st">'E99902'</span>,</span></span>
<span class="r-in"><span>    <span class="st">'C38292'</span>, <span class="st">'A30619'</span>, <span class="st">'D46627'</span>, <span class="st">'E29198'</span>, <span class="st">'A41418'</span>,</span></span>
<span class="r-in"><span>    <span class="st">'D51456'</span>, <span class="st">'C88669'</span>, <span class="st">'E03673'</span>, <span class="st">'A63155'</span>, <span class="st">'B66033'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>pval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.90e-08</span>, <span class="fl">0.06743</span>, <span class="fl">0.01514</span>, <span class="fl">0.08174</span>, <span class="fl">0.00171</span>,</span></span>
<span class="r-in"><span>        <span class="fl">3.60e-05</span>, <span class="fl">0.79149</span>, <span class="fl">0.27201</span>, <span class="fl">0.28295</span>, <span class="fl">7.59e-08</span>,</span></span>
<span class="r-in"><span>        <span class="fl">0.69274</span>, <span class="fl">0.30443</span>, <span class="fl">0.00136</span>, <span class="fl">0.72342</span>, <span class="fl">0.54757</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>lags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">SAFFRONstar</span><span class="op">(</span><span class="va">sample.df2</span>, version<span class="op">=</span><span class="st">'dep'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          pval lag      alphai R</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  2.9000e-08   1 0.005468627 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  6.7430e-02   1 0.001803974 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  1.5140e-02   1 0.007272601 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  8.1740e-02   1 0.003607948 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  1.7100e-03   1 0.003607948 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  3.6000e-05   1 0.003607948 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  7.9149e-01   1 0.014545202 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  2.7201e-01   1 0.018153151 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  2.8295e-01   1 0.007379710 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 7.5900e-08   1 0.007379710 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 6.9274e-01   1 0.007379710 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 3.0443e-01   1 0.018316965 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 1.3600e-03   1 0.007874188 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 7.2342e-01   1 0.007874188 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 5.4757e-01   1 0.018811442 0</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by David S. Robertson, Lathan Liou, Aaditya Ramdas, Natasha A. Karp.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '4c638d00ee22961d7aab55c43dd0309d',
    indexName: 'onlinefdr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>

